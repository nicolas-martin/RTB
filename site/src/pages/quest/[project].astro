---
import BaseLayout from '../../layouts/BaseLayout.astro';
import SiteHeader from '../../components/SiteHeader.astro';
import QuestApp from '../../components/QuestApp';
import { getEntry } from 'astro:content';

export async function getStaticPaths() {
  // Define the available quest projects
  const projects = ['rtb', 'gluex'];
  
  return projects.map(project => ({
    params: { project }
  }));
}

const { project } = Astro.params;
const currentPath = Astro.url.pathname;

// Get project info from ecosystem data using Content Collections
let projectInfo = null;
try {
  const entry = await getEntry('ecosystem', 'plasma');
  console.log('[Quest Page] Looking for project:', project);
  if (entry?.data?.projects) {
    projectInfo = entry.data.projects.find((p: any) => 
      p.quest_slug?.toLowerCase() === project?.toLowerCase() || 
      p.name?.toLowerCase() === project?.toLowerCase()
    );
    console.log('[Quest Page] Found projectInfo:', projectInfo ? {
      name: projectInfo.name,
      logo_src: projectInfo.logo_src,
      cover_image: projectInfo.cover_image,
      twitter: projectInfo.twitter,
      discord: projectInfo.discord
    } : 'NOT FOUND');
  }
} catch (error) {
  console.warn('Could not load ecosystem data for project info:', error);
}
---

<BaseLayout title={`${project?.toUpperCase()} Quests`} description={`Track your progress on ${project?.toUpperCase()} quests.`}>
  <SiteHeader slot="header" currentPath={currentPath} />
  <QuestApp projectId={project} projectInfo={projectInfo || undefined} client:load />
</BaseLayout>
